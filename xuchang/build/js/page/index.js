"use strict";define(["jquery","text!template/template.html","tmp","Swiper","handlebars","lazyload","text!template/blocklist.html","text!template/recommend.html","text!template/dl-list.html"],function(n,t,l,a,e,i,c,s,d){var o=0;function r(t,a){var e=5*t,i=5*t+5,o=a.slice(e,i);return o.map(function(t,a){t.count=a+1}),o}n(".header span").on("click",function(){o=n(this).index()-1,n(".header span").eq(o).addClass("active").siblings().removeClass("active"),n(".cont").css({transform:"translatex(-"+100*o+"%)"})}),n.ajax({url:"/api/bookself",dataType:"json",success:function(t){l(d,t.items,".book-cont>div"),n("img.lazy").lazyload({effect:"fadeIn",container:n(".book-cont")}),n(".book-self-btn").on("click",function(){n(this).toggleClass("active"),n(this).hasClass("active")?(l(s,t.items,".book-cont>div"),n("img.lazy").lazyload({effect:"fadeIn",container:n(".book-cont")})):l(d,t.items,".book-cont>div")})}}),n.ajax({url:"/api/index",dataType:"json",success:function(o){l(t,o.items[0].data,".book-city-cont"),new a(".swiper-container",{loop:!0,autoplay:!0}),l(c,o.items[1],".hot"),o.items[5].data.data.map(function(t,a){t.title=t.data.title,t.cover=t.data.cover,t.fiction_id=t.data.fiction_id}),l(c,o.items[5],".time-free");l(s,r(0,o.items[2].data.data),".recommend-cont"),l(d,r(0,o.items[3].data.data),".gril-cont"),l(d,r(0,o.items[4].data.data),".boy-cont"),l(n(".text").html(),o.items[6],".sift-cont"),n("img.lazy").lazyload({effect:"fadeIn",container:n(".left")}),function(t){if(3<=f)return n(".loading").html("暂无更多数据");var e=n(t).height();n(t).on("scroll",function(){var t,a=n(this).children().height()-e;n(this).scrollTop()+15>=a&&(n(this).off("scroll"),t=++f,n.ajax({url:"/api/loadmore",data:{pagenum:t,limit:20},dataType:"json",success:function(t){l(d,t.items,".load-cont-list",1),m(n(".left")),n("img.lazy").lazyload({effect:"fadeIn",container:n(".left")})}}))})}(n(".left")),n(".change-btn").on("click",function(){var t=1*n(this).data("id"),a=n(this).attr("data"),e=o.items[a];t++,t%=e.data.count/5;var i=2==a?s:d;n(this).data("id",t),l(i,r(t,e.data.data),"."+n(this).prev().attr("class"))})}});var f=0;function m(t){if(f>=3){n(".loading").html("暂无更多数据");return false}var a=n(t).height();n(t).on("scroll",function(){var t=n(this).children().height()-a;if(n(this).scrollTop()+15>=t){n(this).off("scroll");f++;e(f)}});function e(t){n.ajax({url:"/api/loadmore",data:{pagenum:t,limit:20},dataType:"json",success:function t(a){l(d,a.items,".load-cont-list",1);m(n(".left"));n("img.lazy").lazyload({effect:"fadeIn",container:n(".left")})}})}}});